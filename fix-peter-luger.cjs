const fs = require('fs');

console.log('🔧 Fixing Peter Luger Steak House entry and adding to Cynthia\'s picks...\n');

// Read the current file
let content = fs.readFileSync('src/data/google_enriched_restaurants_311_clean.json', 'utf8');

// Find the malformed JSON structure
const malformedPattern = /}\s*{\s*"name":\s*"places\/ChIJR_bK295bwokR8gM6QgEdmkY"/;
const match = content.match(malformedPattern);

if (match) {
  console.log('✅ Found malformed JSON structure');
  
  // Fix the structure by replacing }{ with proper array structure
  const fixedContent = content.replace(malformedPattern, '},\n    {\n      "original_place": {\n        "geometry": {\n          "coordinates": [\n            -73.9625052,\n            40.709877399999996\n          ],\n          "type": "Point"\n        },\n        "properties": {\n          "date": "2024-03-08T08:12:35Z",\n          "google_maps_url": "http://maps.google.com/?cid=5087410620311667698",\n          "location": {\n            "address": "178 Broadway, Brooklyn, NY 11211, United States",\n            "country_code": "US",\n            "name": "Peter Luger Steak House"\n          }\n        },\n        "type": "Feature"\n      },\n      "google_place_id": "ChIJR_bK295bwokR8gM6QgEdmkY",\n      "google_data": {\n        "name": "places/ChIJR_bK295bwokR8gM6QgEdmkY",\n        "id": "ChIJR_bK295bwokR8gM6QgEdmkY",\n        "types": [\n          "steak_house",\n          "meal_takeaway",\n          "restaurant",\n          "food",\n          "point_of_interest",\n          "establishment"\n        ],\n        "nationalPhoneNumber": "(718) 387-7400",\n        "internationalPhoneNumber": "+1 718-387-7400",\n        "formattedAddress": "178 Broadway, Brooklyn, NY 11211, USA",\n        "addressComponents": [\n          {\n            "longText": "178",\n            "shortText": "178",\n            "types": [\n              "street_number"\n            ],\n            "languageCode": "en-US"\n          },\n          {\n            "longText": "Broadway",\n            "shortText": "Broadway",\n            "types": [\n              "route"\n            ],\n            "languageCode": "en"\n          },\n          {\n            "longText": "Southside",\n            "shortText": "Southside",\n            "types": [\n              "neighborhood",\n              "political"\n            ],\n            "languageCode": "en"\n          },\n          {\n            "longText": "Brooklyn",\n            "shortText": "Brooklyn",\n            "types": [\n              "sublocality_level_1",\n              "sublocality",\n              "political"\n            ],\n            "languageCode": "en"\n          },\n          {\n            "longText": "Kings County",\n            "shortText": "Kings County",\n            "types": [\n              "administrative_area_level_2",\n              "political"\n            ],\n            "languageCode": "en"\n          },\n          {\n            "longText": "New York",\n            "shortText": "NY",\n            "types": [\n              "administrative_area_level_1",\n              "political"\n            ],\n            "languageCode": "en"\n          },\n          {\n            "longText": "United States",\n            "shortText": "US",\n            "types": [\n              "country",\n              "political"\n            ],\n            "languageCode": "en"\n          },\n          {\n            "longText": "11211",\n            "shortText": "11211",\n            "types": [\n              "postal_code"\n            ],\n            "languageCode": "en-US"\n          }\n        ],\n        "plusCode": {\n          "globalCode": "87G8P25P+XX",\n          "compoundCode": "P25P+XX Brooklyn, NY, USA"\n        },\n        "location": {\n          "latitude": 40.709877399999996,\n          "longitude": -73.9625052\n        },\n        "viewport": {\n          "low": {\n            "latitude": 40.7085909697085,\n            "longitude": -73.9638923302915\n          },\n          "high": {\n            "latitude": 40.7112889302915,\n            "longitude": -73.9611943697085\n          }\n        },\n        "rating": 4.4,\n        "userRatingCount": 12543,\n        "googleMapsUri": "https://maps.google.com/?cid=5087410620311667698&g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAIYASAA",\n        "websiteUri": "https://peterluger.com/",\n        "displayName": {\n          "text": "Peter Luger Steak House",\n          "languageCode": "en"\n        },\n        "primaryTypeDisplayName": {\n          "text": "Steak House",\n          "languageCode": "en-US"\n        },\n        "primaryType": "steak_house",\n        "shortFormattedAddress": "178 Broadway, Brooklyn",\n        "editorialSummary": {\n          "text": "Cash-only steak icon where old-school waiters serve aged beef in a German beer hall setting.",\n          "languageCode": "en"\n        },\n        "reviews": [\n          {\n            "name": "places/ChIJR_bK295bwokR8gM6QgEdmkY/reviews/Ci9DQUlRQUNvZENodHljRjlvT2s5Q056ZGZha0p6TTNFd1kya3hVbmhoYUZOM1IzYxAB",\n            "relativePublishTimeDescription": "2 months ago",\n            "rating": 5,\n            "text": {\n              "text": "We visited as a group of three — two women (Two women who usually have small appetites) and one man — and ordered the steak for two, baked potato, tomato and onion, and spinach. The portions were generous, and we left feeling very full and satisfied.\\n\\nOur reservation was for 5:45 PM on a Tuesday evening. Although getting to the restaurant during rush hour from Manhattan was a bit challenging and the location was somewhat unusual, it was absolutely worth it. It was the best steak I've ever had, and the high price felt completely justified. Everything we ordered was delicious, and the place was quite busy. I would definitely visit again.",\n              "languageCode": "en"\n            },\n            "originalText": {\n              "text": "We visited as a group of three — two women (Two women who usually have small appetites) and one man — and ordered the steak for two, baked potato, tomato and onion, and spinach. The portions were generous, and we left feeling very full and satisfied.\\n\\nOur reservation was for 5:45 PM on a Tuesday evening. Although getting to the restaurant during rush hour from Manhattan was a bit challenging and the location was somewhat unusual, it was absolutely worth it. It was the best steak I've ever had, and the high price felt completely justified. Everything we ordered was delicious, and the place was quite busy. I would definitely visit again.",\n              "languageCode": "en"\n            },\n            "authorAttribution": {\n              "displayName": "Jenny Shin",\n              "uri": "https://www.google.com/maps/contrib/111536233237960712782/reviews",\n              "photoUri": "https://lh3.googleusercontent.com/a-/ALV-UjXY9QFMevQU77ZvGisJeo_FsUbFNjHOiImMstAcdSfK2f8asHNe=s128-c0x00000000-cc-rp-mo-ba4"\n            },\n            "publishTime": "2025-07-30T13:40:28.956743253Z",\n            "flagContentUri": "https://www.google.com/local/review/rap/report?postId=Ci9DQUlRQUNvZENodHljRjlvT2s5Q056ZGZha0p6TTNFd1kya3hVbmhoYUZOM1IzYxAB&d=17924085&t=1",\n            "googleMapsUri": "https://www.google.com/maps/reviews/data=!4m6!14m5!1m4!2m3!1sCi9DQUlRQUNvZENodHljRjlvT2s5Q056ZGZha0p6TTNFd1kya3hVbmhoYUZOM1IzYxAB!2m1!1s0x89c25bdedbcaf647:0x469a1d01423a03f2"\n          }\n        ],\n        "outdoorSeating": true,\n        "liveMusic": false,\n        "menuForChildren": false,\n        "servesCocktails": true,\n        "servesDessert": true,\n        "servesCoffee": true,\n        "allowsDogs": false,\n        "restroom": true,\n        "goodForGroups": true,\n        "goodForWatchingSports": false,\n        "paymentOptions": {\n          "acceptsDebitCards": true,\n          "acceptsCashOnly": false,\n          "acceptsNfc": true\n        },\n        "parkingOptions": {\n          "freeParkingLot": false,\n          "paidStreetParking": true,\n          "valetParking": false\n        },\n        "accessibilityOptions": {\n          "wheelchairAccessibleEntrance": true,\n          "wheelchairAccessibleRestroom": true,\n          "wheelchairAccessibleSeating": true\n        },\n        "pureServiceAreaBusiness": false,\n        "googleMapsLinks": {\n          "directionsUri": "https://www.google.com/maps/dir//''/data=!4m7!4m6!1m1!4e2!1m2!1m1!1s0x89c25bdedbcaf647:0x469a1d01423a03f2!3e0?g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAIYASAA",\n          "placeUri": "https://maps.google.com/?cid=5087410620311667698&g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAIYASAA",\n          "reviewsUri": "https://www.google.com/maps/place//data=!4m6!3m5!1s0x89c25bdedbcaf647:0x469a1d01423a03f2!8m2!3d40.709877399999996!4d-73.9625052!16s%2Fg%2F11c0qjqjqj?g_mp=CiVnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLkdldFBsYWNlEAIYASAA"\n        },\n        "reviewSummary": {\n          "text": {\n            "text": "People say this steakhouse serves delicious porterhouse steak, creamed spinach, and thick-cut bacon. They also highlight the generous portions, classic atmosphere, and friendly staff.\\n\\nSome reviews mention there can be a long wait.",\n            "languageCode": "en-US"\n          },\n          "flagContentUri": "https://www.google.com/local/review/rap/report?postId=5%401:CAIQACodChtyc19oOi0weWNlekhTQWV4U01uSFJWTFVmdEE%7CCAIQACorChtyc19oOi0weWNlekhTQWV4U01uSFJWTFVmdEESDAi_2OfEBhD44ZHwAg&d=17924085&t=8",\n          "disclosureText": {\n            "text": "Summarized with Gemini",\n            "languageCode": "en-US"\n          },\n          "reviewsUri": "https://www.google.com/maps/place//data=!4m4!3m3!1s0x89c25bdedbcaf647:0x469a1d01423a03f2!9m1!1b1"\n        },\n        "timeZone": {\n          "id": "America/New_York"\n        },\n        "postalAddress": {\n          "regionCode": "US",\n          "languageCode": "en-US",\n          "postalCode": "11211",\n          "administrativeArea": "New York",\n          "locality": "Brooklyn",\n          "addressLines": [\n            "178 Broadway"\n          ]\n        }\n      },\n      "place_classification": "restaurant",\n      "specific_type": "steak_house",\n      "neighborhood_extracted": "Southside",\n      "enrichment_status": "success",\n      "enrichment_date": "2025-09-28T22:20:01.000129",\n      "cynthias_pick": true,\n      "price_display": "$$$$"\n    }');
  
  // Write the fixed content back to the file
  fs.writeFileSync('src/data/google_enriched_restaurants_311_clean.json', fixedContent);
  
  console.log('✅ Fixed JSON structure and added Peter Luger Steak House as Cynthia\'s pick');
  console.log('✅ Restaurant details:');
  console.log('   - Name: Peter Luger Steak House');
  console.log('   - Address: 178 Broadway, Brooklyn, NY 11211, USA');
  console.log('   - Type: Steak House');
  console.log('   - Rating: 4.4 (12,543 reviews)');
  console.log('   - Price: $$$$');
  console.log('   - Cynthia\'s Pick: true');
  
  // Verify the JSON is valid
  try {
    JSON.parse(fixedContent);
    console.log('✅ JSON is valid');
  } catch (e) {
    console.log('❌ JSON Error:', e.message);
  }
} else {
  console.log('❌ Could not find malformed JSON structure');
}

